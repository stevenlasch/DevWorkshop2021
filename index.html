<!DOCTYPE html>
<html>
<head>
<title>GitHub Avatar Viewer</title>

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<style>
    table, th, td {
        border: 2px solid black;
        border-collapse: collapse;
    }
    .headerText {
        margin-top: 10px;
        text-align:center;
    }
    .lookupBtn{
        margin-top: 10px;
    }
    .center {
      margin-left: auto;
      margin-right: auto;
    }
</style>

<script>
async function username_lookup()
{
    try
    {
        let formData = new FormData();
        formData.append('username', document.getElementById("usernametext").value);

        const response = await fetch('/github_profile.php',
                {method: "POST", body: formData});
        if(response.ok)
        {
            let textResponse = await response.text();
            console.log("Username lookup request sent.");
            list_users();
            return;
        }
    } catch {}
    console.log("Error sending username lookup request!");
}

async function list_users()
{
    try
    {
        const response = await fetch('/inspect_db.php');
        if(response.ok)
        {
            const usersJson = await response.json();
            var user = null;
            
            //Clear table first
            document.getElementById("usersTable").innerHTML = "";
            {
                const table = document.getElementById("usersTable");
                const row = table.insertRow();
                const cell1 = row.insertCell(0);
                cell1.innerHTML = '<b>Login</b>';
                const cell2 = row.insertCell(1);
                cell2.innerHTML = '<b>Name</b>';
                const cell3 = row.insertCell(2);
                cell3.innerHTML = '<b>Date Created</b>';
                const cell4 = row.insertCell(3);
                cell4.innerHTML = '<b>Avatar</b>';
            }

            for(var i = usersJson.length - 1; i >= 0; i--) 
            {
                user = usersJson[i];
                const table = document.getElementById("usersTable");
                const row = table.insertRow();
                const cell1 = row.insertCell(0);
                cell1.innerHTML = user['login'];
                const cell2 = row.insertCell(1);
                cell2.innerHTML = user['name'];
                const cell3 = row.insertCell(2);
                cell3.innerHTML = user['created_at'];
                const cell4 = row.insertCell(3);
                cell4.innerHTML = "<img src=\"" + user['avatar_url'] + "\">";
            }
            console.log("Successfully fetched users list.");
            return;
        }
    } catch {}
    document.getElementById("usersTable").innerHTML = "";
    console.log("Error users list!");
}

list_users();
</script>
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>

<body>
<h1 class='headerText'>&emsp;GitHub Avatar Viewer</h1>
<div class="text-center">
    <input type="text" id="usernametext" size=30 style="text-align:center" placeholder="Username">
    <br>
    <input type="button" class="btn btn-primary lookupBtn" value="Request" onclick="username_lookup()">
    <br><br>

    <table id="usersTable" class="table table-horizontal table-bordered center" style="width:50%">
        <thead class="thead-strong">
        <tr>
            <th style="width:15px">ID</th>
            <th width="20px">Login</th>
            <th width="40px">Name</th>
            <th width="20px">Created at</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

</body>
</html>
